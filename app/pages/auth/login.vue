<script setup lang="ts">
import * as v from "valibot";
import type { FormSubmitEvent, AuthFormField } from "@nuxt/ui";

const toast = useToast();
const submiting = ref(false);
const { $i18n } = useNuxtApp();

const fields: AuthFormField[] = [
  {
    name: "email",
    type: "email",
    label: $i18n.t("login.items.email"),
    required: true,
  },
  {
    name: "password",
    type: "password",
    label: $i18n.t("login.items.password"),
    required: true,
  },
];

const providers = [
  {
    label: "Google",
    icon: "i-simple-icons-google",
    onClick: () => {
      toast.add({ title: "Google", description: "Login with Google" });
    },
  },
  {
    label: "GitHub",
    icon: "i-simple-icons-github",
    onClick: () => {
      toast.add({ title: "GitHub", description: "Login with GitHub" });
    },
  },
];

const schema = v.object({
  email: v.pipe(
    v.string($i18n.t("errors.fieldRequired")),
    v.email($i18n.t("errors.invalidEmail"))
  ),

  password: v.pipe(v.string($i18n.t("errors.fieldRequired"))),
});

type Schema = v.InferOutput<typeof schema>;

const testimonials = ref([
  {
    user: {
      name: "Evan You",
      description: "Author of Vue.js and Vite",
      avatar: {
        src: "https://avatars.githubusercontent.com/u/499550?v=4",
        alt: "Evan You",
      },
    },
    quote: "Nuxt on Cloudflare infra with minimal effort - this is huge!",
  },
  {
    user: {
      name: "Igor Minar",
      description: "Software Engineer at Cloudflare",
      avatar: {
        src: "https://avatars.githubusercontent.com/u/216296?v=4",
        alt: "Igor Minar",
      },
    },
    quote:
      "I love the polish and the batteries-included approach. NuxtHub takes web framework and hosting integration to a new level!",
  },
  {
    user: {
      name: "Charlie Hield",
      description: "Senior Creative Technologist",
      avatar: {
        src: "https://avatars.githubusercontent.com/u/527849?v=4",
        alt: "Charlie Hield",
      },
    },
    quote:
      "NuxtHub is hands down the easiest way to get a project from zero to production on the Cloudflare stack!",
  },
  {
    user: {
      name: "Israel Ortuño",
      description: "Co-founder of VueJobs",
      avatar: {
        src: "https://avatars.githubusercontent.com/u/1769417?v=4",
        alt: "Israel Ortuño",
      },
    },
    quote:
      "I can't find an excuse to not go full-stack with Nuxt from now on. Ship fast the Nuxt way, zero config. Just plug & deploy.",
  },
  {
    user: {
      name: "Fayaz Ahmed",
      description: "Indie Hacker",
      avatar: {
        src: "https://avatars.githubusercontent.com/u/15716057?v=4",
        alt: "Fayaz Ahmed",
      },
    },
    quote:
      "Took me less than 90 seconds to deploy an app with DB, KV, File storage and Caching, all on the edge with just a single command.",
  },
  {
    user: {
      name: "Tommy J. Vedvik",
      description: "UX Developer",
      avatar: {
        src: "https://avatars.githubusercontent.com/u/48070?v=4",
        alt: "Tommy J. Vedvik",
      },
    },
    quote:
      "Nuxt is becoming the best framework for bootstrappers imo. NuxtHub is a layer on top of Cloudflare services for cheap & fast full-stack edge hosting.",
  },
  {
    user: {
      name: "Dario Piotrowicz",
      description: "Web Developer at Cloudflare",
      avatar: {
        src: "https://avatars.githubusercontent.com/u/61631103?v=4",
        alt: "Dario Piotrowicz",
      },
    },
    quote:
      "I love how NuxtHub combines, amplifies and simplifies the Cloudflare tooling with the wide and mature Nuxt ecosystem. I cannot wait to see how it will evolve and expand in the future!",
  },
  {
    user: {
      name: "Markus Oberlehner",
      description: "Web Developer",
      avatar: {
        src: "https://avatars.githubusercontent.com/u/6883314?v=4",
        alt: "Markus Oberlehner",
      },
    },
    quote:
      "Just deployed my first site to Cloudflare using NuxtHub. Very sleek experience!",
  },
  {
    user: {
      name: "Anthony Fu",
      description: "Core team Vue.js, Vite & Nuxt",
      avatar: {
        src: "https://avatars.githubusercontent.com/u/11247099?v=4",
        alt: "Anthony Fu",
      },
    },
    quote:
      "It's amazing to be able to run a single command and get existing Nuxt project deployed on edge within minutes! It felt like unlocking the missing infrastructure and UI for Cloudflare, enhancing the developer experience in such an extraordinary way.",
  },
  {
    user: {
      name: "Jonathan Beckman",
      description: "Founder of GuaranTee Time",
      avatar: {
        src: "https://avatars.githubusercontent.com/u/90707158?v=4",
        alt: "Jonathan Beckman",
      },
    },
    quote:
      "NuxtHub and Cloudflare are my go to for full stack apps. The DX is joyous and far superior to any other platform I've used. My team is able to iterate quickly, and build beautiful, performant apps with ease.",
  },
  {
    user: {
      name: "Eckhardt Dreyer",
      description: "Lead Developer at YG",
      avatar: {
        src: "https://avatars.githubusercontent.com/u/37825447?v=4",
        alt: "Eckhardt Dreyer",
      },
    },
    quote:
      "At YG, our team recently grew and that meant more seats on all the tools we use. Migrating our hosting workflow to NuxtHub not only took just a few minutes but saved us money from our previous provider. NuxtHub provides an excellent management layer on top of our infrastructure and we're super happy about the move!",
  },
]);

async function onSubmit(payload: FormSubmitEvent<Schema>) {
  submiting.value = true;
  try {
    await Store.auth.login(payload.data.email, payload.data.password);
    Use.router.push(Use.localePath({ name: "index" }));
  } finally {
    submiting.value = false;
  }
}
</script>

<template>
  <div class="flex w-full h-screen rounded-0" variant="ghost">
    <div class="hidden lg:block w-6/12">
      <div class="p-10">
        <wk-logo class="h-8" />
      </div>
    </div>

    <div class="lg:w-6/12 w-full sticky top-0">
      <UPageCard variant="ghost" class="w-full max-w-md mx-auto mt-36">
        <UAuthForm
          :schema="schema"
          :title="$t('login.title')"
          :description="$t('login.description')"
          :fields="fields"
          :providers="providers"
          :loading="submiting"
          @submit="onSubmit"
        >
          <template #footer>
            {{ $t("login.register.text") }}
            <ULink
              :to="$localePath({ name: 'auth-register' })"
              class="text-primary font-medium"
            >
              {{ $t("login.register.btn") }} </ULink
            >.
          </template>
        </UAuthForm>
      </UPageCard>
    </div>
  </div>
</template>
